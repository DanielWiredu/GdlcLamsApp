@page "/setups-location"
@rendermode InteractiveServer
@inject IJSRuntime JsRuntime;
@inject IUnitOfWork unitOfWork

<PageBreadcrumb Subtitle="Setups" Title="Locations" />

<MudTable Items="@Elements" Dense="true" Hover="true" Striped="true" FixedHeader="true" FixedFooter="true" Height="500px" RowsPerPage="20" Filter="new Func<TblLocation, bool>(FilterFunc1)">
    <ToolBarContent>
        @* <MudText Typo="Typo.h6">Locations</MudText> *@
        <div class="d-flex gap-2">
            <a class="btn btn-sm btn-primary" href="#">
                <i class="ti ti-plus me-1"></i> Add New
            </a>
        </div>
        <MudSpacer />
        <MudTextField @bind-Value="searchString1" Placeholder="Search" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
    </ToolBarContent>
    <HeaderContent>
        <MudTh>Location</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Location">@context.Location</MudTd>
    </RowTemplate>
    <PagerContent>
        <MudTablePager />
    </PagerContent>
</MudTable>

@code {
    private string searchString1 = "";
    private IEnumerable<TblLocation> Elements = new List<TblLocation>();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JsRuntime.InvokeVoidAsync("loadConfig");
            await JsRuntime.InvokeVoidAsync("loadApps");
        }
    }

    protected override async Task OnInitializedAsync()
    {
        Elements = await unitOfWork.Locations.GetAll();
    }

    private bool FilterFunc1(TblLocation element) => FilterFunc(element, searchString1);

    private bool FilterFunc(TblLocation element, string searchString)
    {
        if (string.IsNullOrWhiteSpace(searchString))
            return true;
        if (element.Location.Contains(searchString, StringComparison.OrdinalIgnoreCase))
            return true;
        return false;
    }
}
